# ========================== SYSTEM ==========================

alias whence-function='echo "use declare -f FUNC"'

alias duplicate-tab='open . -a iterm'

alias system-wifi-off='networksetup -setairportpower Wi-Fi off'
alias system-wifi-on='networksetup -setairportpower Wi-Fi on'
alias system-wifi-reboot='system-wifi-off && sleep 2 && system-wifi-on'
alias system-display-link-reset='pkill DisplayLinkUserAgent && sleep 14 && open /Applications/DisplayLink\ Manager.app'
function zsh-remove-term-from-history() { cat ~/.zsh_history | grep -v $@ > ~/.zsh_history_updated && sleep 2 && cp ~/.zsh_history_updated ~/.zsh_history && rm ~/.zsh_history_updated && echo "Quit iTerm to finish the job\!" }
alias zsh-rebuild='(dotfiles-save-zshrc || true) && source ~/.zshrc'
alias tmux-rebuild='dotfiles-save-tmux-conf && cd - && tmux source-file ~/.tmux.conf'
alias vim-rebuild='vim +"source ~/.vimrc" +PluginInstall +qall && dotfiles-save-vimrc && cd -'
alias zsh-edit-config='open-code-editor ~/.zsh && open-code-editor ~/.zshrc'
alias tmux-edit-config='vim ~/.tmux.conf'
alias dropbox-link-desktop='ln -s ~/Dropbox/Desktop ./Desktop'
alias dropbox='cd ~/Dropbox'
alias documents='cd ~/Documents'
alias desktop='cd ~/Desktop'
alias gradle-clear-cache='rm -rf $HOME/.gradle/caches/'
alias system-clear-caches='rm -rf /Users/george.gillams/Library/Caches'
alias system-clear-adobe-caches='rm -rf /Users/george.gillams/Library/Caches/Adobe'

alias in-this-photo='(dotfiles && osascript ./apple\ script/copyITP.scpt ~/Documents/georgegillams/dotfiles/resources/in_this_photo.jpg)'
alias inthisphoto='in-this-photo'

alias calendar-acknowledge-calendar-notifications='(dotfiles && osascript ./apple\ script/acknowledge\ calendar\ notifications.scpt)'

alias nvm-fix-erbium-npm-version='nvm use 13.0.0 && nvm uninstall lts/erbium && nvm install lts/erbium && nvm alias default lts/erbium'

alias weather-southampton='curl wttr.in/Southampton'
alias weather-portsmouth='curl wttr.in/Portsmouth'
alias weather-london='curl wttr.in/London'
alias weather-barcelona='curl wttr.in/Barcelona'
alias weather='weather-southampton';

function launch-zoom-meeting() {
  open https://typeform.zoom.us/j/$1
}

alias vim-edit-config='open-code-editor ~/.vimrc'

alias kill-process='sudo kill -9'
function list-processes-on-port() { sudo lsof -i :$@ }
function list-process-pids-on-port() { list-processes-on-port $@ | grep -v PID | awk '{print $2}' }
function kill-processes-on-port() { for pid in $(list-process-pids-on-port $@); do kill-process $pid; done }

alias system-flush-dns-cache="sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder"
alias system-sleep="pmset sleepnow"
alias system-clear-asl="sudo rm -rf /private/var/log/asl/*.asl"
alias system-clean-desktop="mv ~/Desktop/* ~/.Trash/ && mv ~/.Trash/season_ticket* ~/Desktop/"
alias system-fix-quick-previews="pkill QuickLookUIService"
alias system-fix-audio="sudo killall coreaudiod & sudo kill -9 `ps ax|grep 'coreaudio[a-z]' | awk '{print $1}'`"
alias system-fix-sound="system-fix-audio"
alias system-fix-touch-id="(dotfiles && cd system-install && . ./touch_id.sh)"
alias system-fix-finder-lagging="mv ~/Library/Preferences/com.apple.finder.plist ~/Desktop/ && echo \"NOW RESTART. IF EVERYTHING IS FINE, DELETE ~/Desktop/com.apple.finder.plist\""
alias system-fix-vimrc-location="mkdir -p ~/.config/vim && echo 'source ~/.vimrc' > ~/.config/vim/init.vim"
alias system-open-ms-updater="open /Library/Application\ Support/Microsoft/MAU2.0/Microsoft\ AutoUpdate.app"
alias system-open-cc-updater="open /Applications/Adobe\ Creative\ Cloud/Adobe\ Creative\ Cloud"
alias system-update-brew-apps="brew update && brew outdated && brew upgrade && brew outdated --cask && brew upgrade --cask"
alias system-open-topaz='open /Applications/Topaz\ Photo\ AI.app/'
alias system-update-displaylink='open https://www.synaptics.com/products/displaylink-graphics/downloads/macos'
alias system-update-apps="system-update-brew-apps & (mas outdated && mas upgrade) & system-open-cc-updater & system-open-topaz & system-update-displaylink"
alias system-fix-spotlight='sudo mdutil -E'
alias system-fix-ssh='ssh-add -K ~/.ssh/id_rsa &>/dev/null && echo "Host *\n    UseKeychain yes" > ~/.ssh/config'
alias system-fix-gpg='(gpg-agent --daemon || true) && gpg-agent --default-cache-ttl 2592000 && gpg -s ~/.zshrc && rm ~/.zshrc.gpg'
alias system-disable-spotlight='mv /System/Library/LaunchAgents/com.apple.Spotlight.plist /System/Library/LaunchAgents/com.apple.Spotlight.plist.BAK && mv /System/Library/LaunchDaemons/com.apple.metadata.mds.plist /System/Library/LaunchDaemons/com.apple.metadata.mds.plist.BAK'
alias system-disable-indexing='sudo mdutil -a -i off'
alias system-show-hidden-files='defaults write com.apple.finder AppleShowAllFiles YES'
alias system-fix-rvm-openssl='brew reinstall openssl --ignore-dependencies && brew upgrade ruby-build rbenv'
alias web-browser='w3m'
alias system-fix-dyld='brew update && brew upgrade && brew link --overwrite ruby && brew reinstall ruby vim'

alias system-dark-mode='osascript -e "tell application \"System Events\" to tell appearance preferences to set dark mode to true"'
alias system-light-mode='osascript -e "tell application \"System Events\" to tell appearance preferences to set dark mode to false"'

alias system-dock-hide-forever='defaults write com.apple.dock autohide-delay -float 1000; killall Dock'
alias system-dock-make-stickier='defaults write com.apple.dock autohide-delay -float 5.0; killall Dock'
alias system-dock-move-back='system-dock-restore-defaults && sleep 1 && system-dock-make-stickier'
alias system-dock-restore-defaults='defaults delete com.apple.dock autohide-delay; killall Dock'

alias tmux-create-session='tmux new -s'
alias tmux-attach-session='tmux attach -t'
alias tmux-detach="tmux detach"
alias tmux-detatch="tmux-detach"
alias tmux-split="tmux split-window"
alias tmux-split-vertical="tmux-split"
alias tmux-split-horizontal="tmux split-window -h"
alias tmux-close="tmux kill-pane"
alias tmux-exit="tmux-close"

alias android-shake='$ANDROID_SDK_ROOT/platform-tools/adb shell input keyevent 82'
alias android-shake-twice='android-shake && sleep 3 && android-shake'

alias arrange-displays-RL-with-displaylink='displayplacer "id:37D8832A-2D66-02CA-B9F7-8F30A301B230 res:1680x1050 hz:60 color_depth:8 scaling:on origin:(0,0) degree:0" "id:5768F6DE-C603-B581-0857-D6964E3302DB res:2560x1440 hz:75 color_depth:8 scaling:off origin:(-1774,-1440) degree:0" "id:5768F6DE-C603-B581-C90B-A2661D91F570 res:2560x1440 hz:75 color_depth:4 scaling:off origin:(786,-1440) degree:0"'
alias arrange-displays-RL-no-displaylink='displayplacer "id:37D8832A-2D66-02CA-B9F7-8F30A301B230 res:1680x1050 hz:60 color_depth:8 scaling:on origin:(0,0) degree:0" "id:5768F6DE-C603-B581-0857-D6964E3302DB res:2560x1440 hz:75 color_depth:8 scaling:off origin:(-1652,-1440) degree:0"'
alias arrange-displays-VR-at-desk='displayplacer "id:37D8832A-2D66-02CA-B9F7-8F30A301B230 res:1680x1050 hz:60 color_depth:8 scaling:on origin:(0,0) degree:0" "id:5768F6DE-C603-B581-0857-D6964E3302DB res:2560x1440 hz:75 color_depth:8 scaling:on origin:(-434,-1440) degree:0" "id:4644437E-402F-9B56-9DE9-0966D8C1CFC8 res:1920x1200 hz:60 color_depth:4 scaling:off origin:(2126,-1320) degree:0" "id:FC6F39C0-0678-20F0-9DE9-0966D8C1CFC8 res:1920x1200 hz:60 color_depth:4 scaling:off origin:(-2354,-1320) degree:0"'
alias arrange-displays-VR-away-from-desk='displayplacer "id:37D8832A-2D66-02CA-B9F7-8F30A301B230 res:1680x1050 hz:60 color_depth:8 scaling:on origin:(0,0) degree:0" "id:4644437E-402F-9B56-9DE9-0966D8C1CFC8 res:1920x1080 hz:60 color_depth:4 scaling:off origin:(-153,-1080) degree:0" "id:FC6F39C0-0678-20F0-9DE9-0966D8C1CFC8 res:1920x1080 hz:60 color_depth:4 scaling:off origin:(1767,-1080) degree:0" "id:29DE0002-F2AD-C014-9894-1410B1601597 res:1440x900 hz:60 color_depth:4 scaling:off origin:(-1593,-990) degree:0"'

function immersed () {
  pkill DisplayLinkUserAgent
  sleep 2
  
  displayplacer list | grep "Persistent screen id: 5768F6DE-C603-B581-0857-D6964E3302DB"
  hdmiMonitor=$?
  
  open /Applications/Immersed.app
  system-dark-mode

  if [[ "$hdmiMonitor" -eq 0 ]]; then
    echo "Arranging VR displays for at desk"
    arrange-displays-VR-at-desk && sleep 10 && arrange-displays-VR-at-desk && sleep 10 && arrange-displays-VR-at-desk
  else
    echo "Arranging VR displays for away from desk"
    arrange-displays-VR-away-from-desk && sleep 10 && arrange-displays-VR-away-from-desk && sleep 10 && arrange-displays-VR-away-from-desk
  fi
}

function immersed-end () {
  pkill Immersed
  open /Applications/DisplayLink\ Manager.app
  sleep 4

  system-light-mode
  
  displayplacer list | grep "Persistent screen id: 5768F6DE-C603-B581-0857-D6964E3302DB"
  hdmiMonitor=$?
  displayplacer list | grep "Persistent screen id: 5768F6DE-C603-B581-C90B-A2661D91F570"
  displayLinkMonitor=$?

  if [[ "$hdmiMonitor" -eq 0 && "$displayLinkMonitor" -eq 0 ]]; then
    echo "Arranging RL displays for at desk, with display link"
    arrange-displays-RL-with-displaylink && sleep 10 && arrange-displays-RL-with-displaylink && sleep 10 && arrange-displays-RL-with-displaylink
  elif [[ "$hdmiMonitor" -eq 0 ]]; then
    echo "Arranging RL displays for at desk, without display link"
    arrange-displays-RL-no-displaylink && sleep 10 && arrange-displays-RL-no-displaylink && sleep 10 && arrange-displays-RL-no-displaylink
  else
    echo "Arranging RL displays away from desk"
  fi
}

alias airpods='SwitchAudioSource -s "George’s AirPods Pro" -t input & SwitchAudioSource -s "George’s AirPods Pro" -t output'
alias mic-and-airpods='SwitchAudioSource -s "RØDE VideoMic GO II" -t input & SwitchAudioSource -s "George’s AirPods Pro" -t output'

function merge-pdfs () {
  first_arg=$1
  shift 1 # Shifts the input arguments 1 place to the left to give all args except the first
  gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile="$first_arg" $@
}
